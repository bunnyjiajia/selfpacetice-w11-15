<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Single File JS Example</title>
  <style>
    body { font-family: sans-serif; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>

  <h2>รายชื่อผู้ใช้</h2>

  <button id="loadUsers">โหลดข้อมูล</button>
  <p id="status"></p>

  <input id="search" placeholder="ค้นหาชื่อ..." style="margin-top:10px; display:none;">

  <ul id="userList"></ul>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("loadUsers");
      const status = document.getElementById("status");
      const userList = document.getElementById("userList");
      const searchInput = document.getElementById("search");

      let users = []; // เก็บข้อมูลที่โหลดมา เพื่อเอาไป filter ทีหลัง

      // ฟังก์ชันโหลดข้อมูล
      async function loadUsers() {
        try {
          status.textContent = "กำลังโหลดข้อมูล...";
          status.className = "";
          userList.innerHTML = "";
          searchInput.value = "";
          searchInput.style.display = "none";

          const response = await fetch("https://jsonplaceholder.typicode.com/users");

          if (!response.ok) {
            throw new Error("โหลดข้อมูลล้มเหลว: " + response.status);
          }

          users = await response.json(); // เก็บข้อมูลทั้งหมด

          // แสดงข้อมูลทั้งหมดครั้งแรก
          renderList(users);

          status.textContent = "โหลดสำเร็จ ✔";
          status.className = "success";

          // เปิดช่องค้นหาเมื่อโหลดสำเร็จ
          searchInput.style.display = "block";

        } catch (err) {
          status.textContent = "เกิดข้อผิดพลาด: " + err.message;
          status.className = "error";
        }
      }

      // ฟังก์ชันแสดงผลรายการ
      function renderList(data) {
        userList.innerHTML = "";
        data.forEach(u => {
          const li = document.createElement("li");
          li.textContent = `${u.name} (${u.email})`;
          userList.appendChild(li);
        });
      }

      // ฟังก์ชันค้นหาแบบ real-time
      function filterUsers() {
        const keyword = searchInput.value.toLowerCase();
        const filtered = users.filter(u =>
          u.name.toLowerCase().includes(keyword)
        );
        renderList(filtered);
      }

      btn.addEventListener("click", loadUsers);
      searchInput.addEventListener("input", filterUsers);
    });
  </script>

</body>
</html>
